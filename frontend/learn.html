<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartFarm Nexus | Learn</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

  <style>
    /* --------------------------------------------------- */
    /* THEME & COLOR VARIABLES */
    /* --------------------------------------------------- */
    :root {
      --bg-color: #0A0F1A;
      --grid-color: rgba(34, 197, 94, 0.05);
      --primary-glow: #22c55e;
      --secondary-glow: #16a34a;
      --glow-shadow: rgba(34, 197, 94, 0.6);
      --text-primary: #e6f7ff;
      --text-secondary: #94a3b8;
      --card-bg: rgba(15, 23, 42, 0.85);
      --border-color: rgba(34, 197, 94, 0.25);
      --input-bg: rgba(10, 15, 26, 0.7);
      --hover-bg: rgba(34, 197, 94, 0.1);
      --danger-color: #ef4444;
      --upvote-color: #10b981;
      --downvote-color: #f59e0b;
    }

    html[data-theme="light"] {
      --bg-color: #f0f9ff;
      --grid-color: rgba(22, 163, 74, 0.08);
      --primary-glow: #16a34a;
      --secondary-glow: #15803d;
      --glow-shadow: rgba(22, 163, 74, 0.4);
      --text-primary: #0c2e48;
      --text-secondary: #334155;
      --card-bg: rgba(255, 255, 255, 0.9);
      --border-color: rgba(22, 163, 74, 0.3);
      --input-bg: rgba(226, 232, 240, 0.8);
      --hover-bg: rgba(22, 163, 74, 0.05);
      --danger-color: #dc2626;
      --upvote-color: #059669;
      --downvote-color: #d97706;
    }

    /* --------------------------------------------------- */
    /* GENERAL & LAYOUT STYLES */
    /* --------------------------------------------------- */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-primary);
      transition: background-color 0.5s ease;
      overflow-x: hidden;
    }

    /* Animated Grid Background */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image:
              radial-gradient(circle at 25px 25px, var(--grid-color) 2px, transparent 0),
              linear-gradient(var(--grid-color) 1px, transparent 1px),
              linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: move-grid 60s linear infinite;
      opacity: 0.3;
      z-index: -2;
    }

    @keyframes move-grid {
      from { background-position: 0 0; }
      to { background-position: 50px 50px; }
    }

    /* Insects Animation */
    .insect {
      position: fixed;
      font-size: 12px;
      color: var(--primary-glow);
      opacity: 0.6;
      pointer-events: none;
      z-index: -1;
      transition: all 0.3s ease;
    }

    .insect.beetle { color: #8b5cf6; }
    .insect.butterfly { color: #f59e0b; }
    .insect.spider { color: #ef4444; }
    .insect.ant { color: var(--secondary-glow); }

    /* --------------------------------------------------- */
    /* HEADER LAYOUT */
    /* --------------------------------------------------- */
    .top-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--card-bg);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 2rem;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-glow);
      text-decoration: none;
    }

    .menu-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      display: none;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .menu-toggle:hover {
      background: var(--hover-bg);
      color: var(--primary-glow);
    }

    .nav-search {
      flex: 1;
      max-width: 500px;
      position: relative;
    }

    .nav-search .input-field {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 3rem;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 25px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .nav-search .input-field:focus {
      outline: none;
      border-color: var(--primary-glow);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }

    .nav-search i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      z-index: 10;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: var(--hover-bg);
      color: var(--primary-glow);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 2px solid var(--primary-glow);
      transition: all 0.3s ease;
    }

    .user-avatar:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px var(--glow-shadow);
    }

    .page-wrapper { display: flex; }

    .left-sidebar {
      width: 280px;
      height: calc(100vh - 81px);
      position: sticky;
      top: 81px;
      background: var(--bg-color);
      border-right: 1px solid var(--border-color);
      padding: 2rem 1.5rem;
      overflow-y: auto;
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .main-content {
      flex-grow: 1;
      padding: 2rem;
      max-width: 900px;
      margin: 0 auto;
      min-height: calc(100vh - 81px);
    }

    /* --------------------------------------------------- */
    /* WIDGET & POST STYLES */
    /* --------------------------------------------------- */
    .widget {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .widget:hover {
      border-color: var(--primary-glow);
      box-shadow: 0 5px 20px rgba(34, 197, 94, 0.1);
    }

    .widget-title {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .performance-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .stat-item {
      text-align: center;
      padding: 1rem;
      background: var(--input-bg);
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      background: var(--hover-bg);
      transform: translateY(-2px);
    }

    .stat-number {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-glow);
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .trending-topics {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .topic-tag {
      background: var(--input-bg);
      padding: 0.4rem 0.9rem;
      border-radius: 20px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }

    .topic-tag:hover, .topic-tag.active {
      background: var(--hover-bg);
      color: var(--primary-glow);
      border-color: var(--primary-glow);
      transform: translateY(-1px);
    }

    .post-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      margin-bottom: 2rem;
      overflow: hidden;
      animation: fade-in-post 0.6s ease forwards;
      cursor: pointer;
      transition: all 0.4s ease;
      backdrop-filter: blur(10px);
    }

    .post-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px var(--glow-shadow);
      border-color: var(--primary-glow);
    }

    @keyframes fade-in-post {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .post-cover-image {
      width: 100%;
      height: 220px;
      object-fit: cover;
      transition: all 0.3s ease;
    }

    .post-card:hover .post-cover-image {
      transform: scale(1.05);
    }

    .post-body {
      padding: 2rem;
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .author-name {
      font-weight: 600;
    }

    .edited-tag {
      font-size: 0.8rem;
      color: var(--text-secondary);
      font-style: italic;
      margin-left: 0.5rem;
    }

    .post-title {
      font-size: 1.6rem;
      margin-bottom: 1rem;
      color: var(--primary-glow);
      line-height: 1.3;
    }

    .post-content-preview {
      color: var(--text-secondary);
      line-height: 1.7;
      max-height: 4.5rem;
      overflow: hidden;
      position: relative;
      margin-bottom: 1rem;
    }

    .post-content-preview::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2rem;
      background: linear-gradient(to bottom, transparent, var(--card-bg));
    }

    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .post-tag {
      background: var(--input-bg);
      color: var(--text-secondary);
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      border: 1px solid var(--border-color);
    }

    .post-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 1.5rem;
      border-top: 1px solid var(--border-color);
      padding-top: 1.5rem;
    }

    .vote-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .vote-buttons {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      background: var(--input-bg);
      border-radius: 25px;
      padding: 0.3rem;
    }

    .vote-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      padding: 0.5rem;
      border-radius: 50%;
      min-width: 32px;
      height: 32px;
    }

    .vote-btn:hover {
      transform: scale(1.1);
    }

    .vote-btn.upvote:hover, .vote-btn.upvote.active {
      color: var(--upvote-color);
      background: rgba(16, 185, 129, 0.1);
    }

    .vote-btn.downvote:hover, .vote-btn.downvote.active {
      color: var(--downvote-color);
      background: rgba(245, 158, 11, 0.1);
    }

    .vote-counts {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    .upvote-count {
      color: var(--upvote-color);
      font-weight: 600;
    }

    .downvote-count {
      color: var(--downvote-color);
      font-weight: 600;
    }

    .post-meta {
      display: flex;
      align-items: center;
      gap: 1rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* --------------------------------------------------- */
    /* MODAL STYLES */
    /* --------------------------------------------------- */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      width: 90%;
      max-width: 750px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      backdrop-filter: blur(15px);
      overflow: hidden;
    }

    .modal-overlay.open .modal-content {
      transform: scale(1);
    }

    .modal-header {
      padding: 2rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.5rem;
    }

    .modal-close-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .modal-close-btn:hover {
      background: var(--hover-bg);
      color: var(--primary-glow);
    }

    .modal-body {
      padding: 2rem;
      overflow-y: auto;
    }

    .input-group {
      margin-bottom: 1.5rem;
    }

    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    #image-preview {
      max-width: 120px;
      max-height: 120px;
      border-radius: 12px;
      margin-top: 1rem;
      display: none;
      border: 2px solid var(--border-color);
    }

    #view-post-cover {
      width: 100%;
      max-height: 350px;
      object-fit: cover;
      border-radius: 16px;
      margin-bottom: 2rem;
    }

    #view-post-content {
      line-height: 1.8;
      font-size: 1.05rem;
    }

    .comments-section {
      margin-top: 3rem;
      border-top: 1px solid var(--border-color);
      padding-top: 2rem;
    }

    .comment {
      background: var(--input-bg);
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      border: 1px solid var(--border-color);
    }

    .comment-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .comment-author {
      font-weight: 600;
    }

    .comment-form {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
    }

    /* --------------------------------------------------- */
    /* FORM ELEMENTS */
    /* --------------------------------------------------- */
    .input-field {
      width: 100%;
      padding: 1rem 1.25rem;
      background-color: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--primary-glow);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }

    textarea.input-field {
      resize: vertical;
      min-height: 140px;
      line-height: 1.6;
    }

    .btn {
      padding: 0.8rem 1.75rem;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary-glow);
      color: #fff;
    }

    .btn-primary:hover {
      filter: brightness(1.1);
      box-shadow: 0 5px 20px var(--glow-shadow);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--input-bg);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--hover-bg);
      border-color: var(--primary-glow);
    }

    .btn-danger {
      background: var(--danger-color);
      color: #fff;
    }

    .btn-danger:hover {
      filter: brightness(1.1);
      transform: translateY(-2px);
    }

    /* --------------------------------------------------- */
    /* RESPONSIVE DESIGN */
    /* --------------------------------------------------- */
    @media (max-width: 1024px) {
      .main-content {
        max-width: 800px;
        padding: 1.5rem;
      }
    }

    @media (max-width: 900px) {
      .menu-toggle {
        display: block;
      }

      .nav-search {
        display: none;
      }

      .left-sidebar {
        position: fixed;
        transform: translateX(-100%);
        z-index: 200;
        height: 100vh;
        top: 0;
        border: none;
        box-shadow: 10px 0 30px rgba(0,0,0,0.3);
        width: 300px;
      }

      .left-sidebar.open {
        transform: translateX(0);
      }

      .page-wrapper {
        display: block;
      }

      .main-content {
        padding: 1.5rem 1rem;
      }

      .post-body {
        padding: 1.5rem;
      }
    }

    @media (max-width: 768px) {
      .top-header {
        padding: 0.75rem 1rem;
        gap: 1rem;
      }

      .logo span {
        display: none;
      }

      .main-content {
        padding: 1rem;
      }

      .post-card:hover {
        transform: translateY(-4px) scale(1.01);
      }

      .modal-content {
        width: 95%;
        max-width: none;
      }

      .modal-header,
      .modal-body {
        padding: 1.5rem;
      }

      .post-footer {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }
    }

    @media (max-width: 480px) {
      .performance-stats {
        grid-template-columns: 1fr;
      }

      .vote-section {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
    }

    /* --------------------------------------------------- */
    /* LOADING ANIMATION */
    /* --------------------------------------------------- */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .loading i {
      animation: spin 1s linear infinite;
      font-size: 2rem;
      color: var(--primary-glow);
    }

    /*new*/
    /* --------------------------------------------------- */
    /* HEADER LAYOUT - UPDATED */
    /* --------------------------------------------------- */
    .top-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--card-bg);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 2rem;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-glow);
      text-decoration: none;
      flex-shrink: 0; /* logo won't shrink */
    }

    .menu-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      display: none;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .menu-toggle:hover {
      background: var(--hover-bg);
      color: var(--primary-glow);
    }

    .nav-search {
      flex: 1;
      max-width: 500px;
      position: relative;
      margin-left: auto;      /* push toward the right */
      margin-right: 1.5rem;   /* spacing before avatar & toggle */
    }

    .nav-search .input-field {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 3rem;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 25px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .nav-search .input-field:focus {
      outline: none;
      border-color: var(--primary-glow);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }

    .nav-search i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      z-index: 10;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-left: auto;  /* sticks to the far right */
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: var(--hover-bg);
      color: var(--primary-glow);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 2px solid var(--primary-glow);
      transition: all 0.3s ease;
    }

    .user-avatar:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px var(--glow-shadow);
    }
    /*new*/

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<header class="top-header">
  <button class="menu-toggle" id="menu-toggle"><i class="fas fa-bars"></i></button>
  <div class="logo">
    <i class="fas fa-seedling"></i>
    <span>SmartFarm</span>
  </div>

  <div class="nav-search">
    <i class="fas fa-search"></i>
    <input type="text" id="main-search-input" class="input-field" placeholder="Search posts, topics, authors...">
  </div>

  <div class="header-actions">
    <button class="theme-toggle" id="theme-toggle"><i class="fas fa-sun"></i></button>
    <img src="https://placehold.co/36x36/22c55e/FFF?text=U" alt="User Avatar" class="user-avatar">
  </div>
</header>

<div class="page-wrapper">
  <aside class="left-sidebar" id="left-sidebar">
    <button class="btn btn-primary" id="create-post-btn" style="width: 100%; margin-bottom: 2rem;"><i class="fas fa-plus"></i> Create Post</button>

    <div class="widget">
      <h2 class="widget-title"><i class="fas fa-filter"></i> Filter Posts</h2>
      <button class="btn btn-secondary" id="my-posts-btn" style="width: 100%; margin-bottom: 1rem;"><i class="fas fa-user"></i> My Posts</button>
      <button class="btn btn-secondary" id="all-posts-btn" style="width: 100%;"><i class="fas fa-globe"></i> All Posts</button>
    </div>

    <div class="widget">
      <h2 class="widget-title"><i class="fas fa-chart-line"></i> Your Performance</h2>
      <div class="performance-stats">
        <div class="stat-item">
          <div class="stat-number" id="user-posts-count">3</div>
          <div class="stat-label">Posts</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="user-total-votes">51</div>
          <div class="stat-label">Total Votes</div>
        </div>
      </div>
    </div>

    <div class="widget">
      <h2 class="widget-title"><i class="fas fa-fire"></i> Trending Topics</h2>
      <div class="trending-topics" id="trending-topics-container"></div>
    </div>
  </aside>

  <main class="main-content">
    <div id="active-filter" style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: var(--input-bg); border-radius: 12px; border: 1px solid var(--border-color);">
      <span>Filtered by: <strong id="filter-text"></strong></span>
      <button id="clear-filter" style="background: none; border: none; color: var(--primary-glow); cursor: pointer; margin-left: 1rem;"><i class="fas fa-times"></i> Clear</button>
    </div>

    <div id="post-feed">
      <!-- Posts will be dynamically inserted here -->
    </div>
  </main>
</div>

<!-- Create/Edit Post Modal -->
<div class="modal-overlay" id="create-post-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="modal-form-title">Create a New Post</h2>
      <button class="modal-close-btn"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <form id="create-post-form">
        <input type="hidden" id="post-id-input">

        <div class="input-group">
          <label for="post-title-input">Post Title</label>
          <input type="text" id="post-title-input" class="input-field" placeholder="Enter an engaging title..." required>
        </div>

        <div class="input-group">
          <label for="post-content-input">Content</label>
          <textarea id="post-content-input" class="input-field" placeholder="Share your farming knowledge, tips, and experiences..." required></textarea>
        </div>

        <div class="input-group">
          <label for="post-tags-input">Tags</label>
          <input type="text" id="post-tags-input" class="input-field" placeholder="irrigation, pests, organic, soil (comma-separated)">
        </div>

        <div class="input-group">
          <label for="image-upload-input">Cover Image</label>
          <button type="button" class="btn btn-secondary" onclick="document.getElementById('image-upload-input').click()">
            <i class="fas fa-image"></i> Choose Image
          </button>
          <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
          <img id="image-preview" src="" alt="Image Preview">
        </div>

        <div class="modal-actions">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-paper-plane"></i> Publish Post
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- View Post Modal -->
<div class="modal-overlay" id="view-post-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="view-post-title"></h2>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="edit-post-btn" style="display: none;"><i class="fas fa-edit"></i> Edit</button>
        <button class="btn btn-danger" id="delete-post-btn" style="display: none;"><i class="fas fa-trash"></i> Delete</button>
        <button class="modal-close-btn"><i class="fas fa-times"></i></button>
      </div>
    </div>
    <div class="modal-body">
      <img src="" alt="Post Cover Image" id="view-post-cover" style="display: none;">
      <div class="post-header" id="view-post-header"></div>
      <div id="view-post-content"></div>
      <div class="comments-section">
        <h3 class="widget-title"><i class="fas fa-comments"></i> Comments</h3>
        <div id="comments-list"></div>
        <form class="comment-form" id="comment-form">
          <input type="text" class="input-field" placeholder="Add a comment..." required>
          <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- ELEMENT SELECTORS ---
    const postFeed = document.getElementById('post-feed');
    const mainSearchInput = document.getElementById('main-search-input');
    const menuToggle = document.getElementById('menu-toggle');
    const leftSidebar = document.getElementById('left-sidebar');
    const myPostsBtn = document.getElementById('my-posts-btn');
    const allPostsBtn = document.getElementById('all-posts-btn');
    const trendingTopicsContainer = document.getElementById('trending-topics-container');
    const activeFilter = document.getElementById('active-filter');
    const filterText = document.getElementById('filter-text');
    const clearFilter = document.getElementById('clear-filter');

    // --- MODALS ---
    const createPostModal = document.getElementById('create-post-modal');
    const viewPostModal = document.getElementById('view-post-modal');
    const createPostBtn = document.getElementById('create-post-btn');

    // --- FORMS & INPUTS ---
    const createPostForm = document.getElementById('create-post-form');
    const modalFormTitle = document.getElementById('modal-form-title');
    const postIdInput = document.getElementById('post-id-input');
    const postTitleInput = document.getElementById('post-title-input');
    const postContentInput = document.getElementById('post-content-input');
    const postTagsInput = document.getElementById('post-tags-input');
    const imageUploadInput = document.getElementById('image-upload-input');
    const imagePreview = document.getElementById('image-preview');

    // --- VIEW POST MODAL ELEMENTS ---
    const editPostBtn = document.getElementById('edit-post-btn');
    const deletePostBtn = document.getElementById('delete-post-btn');

    let newPostImageData = null;
    let currentFilter = null;
    let currentFilterType = null;

    // Enhanced posts data with separate vote tracking
    let posts = [
      {
        id: 1,
        author: 'Alex Johnson',
        avatar: 'https://placehold.co/40x40/22c55e/FFF?text=A',
        title: 'Optimizing Drip Irrigation for Maximum Efficiency',
        content: 'Drip irrigation is a highly efficient method for watering crops, delivering water directly to the root zone. This minimizes water waste and reduces the risk of fungal diseases. After implementing drip irrigation in my tomato greenhouse, I observed a 40% reduction in water usage while maintaining optimal soil moisture levels. The key is proper emitter spacing and pressure regulation to ensure uniform water distribution across all plants.',
        upvotes: 18,
        downvotes: 3,
        userVote: null, // null, 'up', or 'down'
        image: 'https://placehold.co/800x400/22c55e/FFF?text=Drip+Irrigation',
        comments: [
          {author: 'Farmer Joe', text: 'Great detailed explanation! What pressure do you recommend for tomatoes?'},
          {author: 'Sarah Green', text: 'This helped me reduce my water bill significantly. Thank you!'}
        ],
        tags: ['irrigation', 'tomatoes', 'water-efficiency'],
        isEdited: false,
        timestamp: new Date('2024-08-20')
      },
      {
        id: 2,
        author: 'Maria Garcia',
        avatar: 'https://placehold.co/40x40/16a34a/FFF?text=M',
        title: 'Biological Pest Control: Ladybugs vs Aphids',
        content: 'Aphids can be a major problem in greenhouses, especially during warm seasons. Instead of using chemical pesticides, I introduced a colony of ladybugs into my greenhouse. Each ladybug can consume up to 5,000 aphids during its lifetime. The results were remarkable - within two weeks, the aphid population was completely under control. This method is not only environmentally friendly but also cost-effective in the long run.',
        upvotes: 32,
        downvotes: 4,
        userVote: 'up',
        image: 'https://placehold.co/800x400/16a34a/FFF?text=Ladybugs+Control',
        comments: [
          {author: 'Farmer Joe', text: 'Brilliant approach! Where do you source your ladybugs?'},
          {author: 'Mike Chen', text: 'I tried this method last year with great success!'}
        ],
        tags: ['pests', 'organic', 'biological-control'],
        isEdited: true,
        timestamp: new Date('2024-08-22')
      },
      {
        id: 3,
        author: 'Current User',
        avatar: 'https://placehold.co/40x40/9ca3af/FFF?text=U',
        title: 'Soil pH Management for Blueberry Cultivation',
        content: 'Maintaining the correct soil pH is crucial for optimal plant growth and nutrient absorption. For blueberries, a pH between 4.5 and 5.5 is ideal. I use sulfur amendments to lower pH naturally and test the soil monthly using a digital pH meter. Regular monitoring has increased my blueberry yield by 25% compared to previous seasons. It\'s important to make gradual adjustments as sudden pH changes can shock the plants.',
        upvotes: 12,
        downvotes: 2,
        userVote: null,
        image: null,
        comments: [
          {author: 'Berry Farmer', text: 'What type of sulfur amendment do you recommend?'}
        ],
        tags: ['soil', 'nutrients', 'blueberries', 'pH'],
        isEdited: false,
        timestamp: new Date('2024-08-23')
      },
      {
        id: 4,
        author: 'David Kim',
        avatar: 'https://placehold.co/40x40/8b5cf6/FFF?text=D',
        title: 'Greenhouse Automation: Smart Sensors for Climate Control',
        content: 'Implementing IoT sensors in my greenhouse has revolutionized how I manage environmental conditions. Temperature, humidity, and soil moisture sensors connected to an automated system maintain optimal growing conditions 24/7. The initial investment was significant, but the improved crop quality and reduced labor costs have made it worthwhile. Plants show 15% better growth rates with consistent environmental control.',
        upvotes: 28,
        downvotes: 5,
        userVote: null,
        image: 'https://placehold.co/800x400/8b5cf6/FFF?text=Smart+Greenhouse',
        comments: [],
        tags: ['automation', 'sensors', 'greenhouse', 'technology'],
        isEdited: false,
        timestamp: new Date('2024-08-24')
      }
    ];

    // Insect animation system
    function createInsects() {
      const insects = ['🐛', '🦋', '🕷️', '🐜', '🐝', '🦗'];
      const insectClasses = ['beetle', 'butterfly', 'spider', 'ant', 'bee', 'cricket'];

      for (let i = 0; i < 8; i++) {
        const insect = document.createElement('div');
        const randomInsect = Math.floor(Math.random() * insects.length);
        insect.className = `insect ${insectClasses[randomInsect]}`;
        insect.textContent = insects[randomInsect];
        insect.style.left = Math.random() * 100 + '%';
        insect.style.top = Math.random() * 100 + '%';
        document.body.appendChild(insect);

        animateInsect(insect);
      }
    }

    function animateInsect(insect) {
      function move() {
        const currentX = parseFloat(insect.style.left);
        const currentY = parseFloat(insect.style.top);

        const deltaX = (Math.random() - 0.5) * 4;
        const deltaY = (Math.random() - 0.5) * 4;

        let newX = currentX + deltaX;
        let newY = currentY + deltaY;

        // Keep insects within viewport bounds
        newX = Math.max(0, Math.min(100, newX));
        newY = Math.max(0, Math.min(100, newY));

        insect.style.left = newX + '%';
        insect.style.top = newY + '%';

        // Random duration between moves
        setTimeout(move, Math.random() * 3000 + 2000);
      }

      move();
    }

    function renderPosts(filteredPosts = posts) {
      postFeed.innerHTML = '';
      if (filteredPosts.length === 0) {
        postFeed.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <h3>No posts found</h3>
                        <p>Try adjusting your search or filter criteria.</p>
                    </div>
                `;
        return;
      }

      filteredPosts.forEach((post, index) => {
        const postElement = document.createElement('div');
        postElement.className = 'post-card';
        postElement.dataset.id = post.id;
        postElement.style.animationDelay = `${index * 0.1}s`;

        const totalVotes = post.upvotes + post.downvotes;
        const netVotes = post.upvotes - post.downvotes;

        postElement.innerHTML = `
                    ${post.image ? `<img src="${post.image}" alt="Post cover image" class="post-cover-image">` : ''}
                    <div class="post-body">
                        <div class="post-header">
                            <img src="${post.avatar}" alt="Author Avatar" class="user-avatar">
                            <div>
                                <div class="author-name">${post.author} ${post.isEdited ? '<span class="edited-tag">(edited)</span>' : ''}</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">${formatDate(post.timestamp)}</div>
                            </div>
                        </div>
                        <h3 class="post-title">${post.title}</h3>
                        <p class="post-content-preview">${post.content}</p>
                        ${post.tags.length > 0 ? `
                            <div class="post-tags">
                                ${post.tags.map(tag => `<span class="post-tag">#${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="post-footer">
                            <div class="vote-section">
                                <div class="vote-buttons">
                                    <button class="vote-btn upvote ${post.userVote === 'up' ? 'active' : ''}" data-post-id="${post.id}" data-vote="up">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="vote-btn downvote ${post.userVote === 'down' ? 'active' : ''}" data-post-id="${post.id}" data-vote="down">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </div>
                                <div class="vote-counts">
                                    <span class="upvote-count">+${post.upvotes}</span>
                                    <span class="downvote-count">-${post.downvotes}</span>
                                </div>
                            </div>
                            <div class="post-meta">
                                <div><i class="fas fa-comment"></i> ${post.comments.length}</div>
                                <div><i class="fas fa-eye"></i> ${Math.floor(Math.random() * 200) + 50}</div>
                            </div>
                        </div>
                    </div>
                `;
        postFeed.appendChild(postElement);
      });
    }

    function formatDate(date) {
      const now = new Date();
      const diff = now - date;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));

      if (days === 0) return 'Today';
      if (days === 1) return 'Yesterday';
      if (days < 7) return `${days} days ago`;
      return date.toLocaleDateString();
    }

    function updateTrendingTopics() {
      const tagCounts = {};
      posts.forEach(post => {
        post.tags.forEach(tag => {
          tagCounts[tag] = (tagCounts[tag] || 0) + 1;
        });
      });

      trendingTopicsContainer.innerHTML = '';
      const sortedTags = Object.entries(tagCounts)
              .sort((a, b) => b[1] - a[1])
              .slice(0, 8);

      sortedTags.forEach(([tag, count]) => {
        const tagEl = document.createElement('div');
        tagEl.className = 'topic-tag';
        tagEl.textContent = `#${tag} (${count})`;
        tagEl.dataset.tag = tag;
        trendingTopicsContainer.appendChild(tagEl);
      });
    }

    function updateUserStats() {
      const userPosts = posts.filter(p => p.author === 'Current User');
      const totalVotes = userPosts.reduce((sum, post) => sum + post.upvotes - post.downvotes, 0);

      document.getElementById('user-posts-count').textContent = userPosts.length;
      document.getElementById('user-total-votes').textContent = totalVotes;
    }

    function filterPosts(filterType, filterValue) {
      currentFilter = filterValue;
      currentFilterType = filterType;

      let filteredPosts = posts;

      switch (filterType) {
        case 'tag':
          filteredPosts = posts.filter(post => post.tags.includes(filterValue));
          filterText.textContent = `#${filterValue}`;
          break;
        case 'author':
          filteredPosts = posts.filter(post => post.author === filterValue);
          filterText.textContent = `Posts by ${filterValue}`;
          break;
        case 'search':
          const searchTerm = filterValue.toLowerCase();
          filteredPosts = posts.filter(post =>
                  post.title.toLowerCase().includes(searchTerm) ||
                  post.content.toLowerCase().includes(searchTerm) ||
                  post.author.toLowerCase().includes(searchTerm) ||
                  post.tags.some(tag => tag.toLowerCase().includes(searchTerm))
          );
          filterText.textContent = `"${filterValue}"`;
          break;
      }

      // Update trending topics active state
      document.querySelectorAll('.topic-tag').forEach(tag => {
        tag.classList.toggle('active', tag.dataset.tag === filterValue);
      });

      activeFilter.style.display = filterType ? 'block' : 'none';
      renderPosts(filteredPosts);
    }

    function clearActiveFilter() {
      currentFilter = null;
      currentFilterType = null;
      activeFilter.style.display = 'none';
      document.querySelectorAll('.topic-tag').forEach(tag => tag.classList.remove('active'));
      mainSearchInput.value = '';
      renderPosts();
    }

    function openModal(modal) {
      modal.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(modal) {
      modal.classList.remove('open');
      document.body.style.overflow = '';
    }

    // Event Listeners
    createPostBtn.addEventListener('click', () => {
      modalFormTitle.textContent = "Create a New Post";
      createPostForm.reset();
      postIdInput.value = '';
      imagePreview.style.display = 'none';
      newPostImageData = null;
      openModal(createPostModal);
    });

    // Trending topics click handler
    trendingTopicsContainer.addEventListener('click', (e) => {
      const topicTag = e.target.closest('.topic-tag');
      if (topicTag) {
        const tag = topicTag.dataset.tag;
        filterPosts('tag', tag);
      }
    });

    // Clear filter
    clearFilter.addEventListener('click', clearActiveFilter);

    // Search functionality
    mainSearchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.trim();
      if (searchTerm) {
        filterPosts('search', searchTerm);
      } else {
        clearActiveFilter();
      }
    });

    // Modal close handlers
    [createPostModal, viewPostModal].forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay') || e.target.closest('.modal-close-btn')) {
          closeModal(modal);
        }
      });
    });

    // Image upload handler
    imageUploadInput.addEventListener('change', () => {
      const file = imageUploadInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          newPostImageData = e.target.result;
          imagePreview.src = newPostImageData;
          imagePreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    // Form submission
    createPostForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const editingId = postIdInput.value;
      const tags = postTagsInput.value
              .split(',')
              .map(tag => tag.trim().toLowerCase().replace(/[^a-z0-9-]/g, ''))
              .filter(Boolean);

      if (editingId) {
        // Editing existing post
        const post = posts.find(p => p.id == editingId);
        post.title = postTitleInput.value;
        post.content = postContentInput.value;
        post.tags = tags;
        post.isEdited = true;
        if (newPostImageData) post.image = newPostImageData;
      } else {
        // Creating new post
        const newPost = {
          id: Date.now(),
          author: 'Current User',
          avatar: 'https://placehold.co/40x40/9ca3af/FFF?text=U',
          title: postTitleInput.value,
          content: postContentInput.value,
          upvotes: 0,
          downvotes: 0,
          userVote: null,
          image: newPostImageData,
          comments: [],
          tags: tags,
          isEdited: false,
          timestamp: new Date()
        };
        posts.unshift(newPost);
      }

      renderPosts();
      updateTrendingTopics();
      updateUserStats();
      closeModal(createPostModal);
    });

    // Post interactions
    postFeed.addEventListener('click', (e) => {
      const voteBtn = e.target.closest('.vote-btn');
      const postCard = e.target.closest('.post-card');

      if (voteBtn) {
        e.stopPropagation();
        const postId = parseInt(voteBtn.dataset.postId);
        const voteType = voteBtn.dataset.vote;
        const post = posts.find(p => p.id === postId);

        if (post.userVote === voteType) {
          // Remove vote
          if (voteType === 'up') post.upvotes--;
          else post.downvotes--;
          post.userVote = null;
        } else {
          // Change or add vote
          if (post.userVote === 'up') post.upvotes--;
          else if (post.userVote === 'down') post.downvotes--;

          if (voteType === 'up') post.upvotes++;
          else post.downvotes++;

          post.userVote = voteType;
        }

        renderPosts();
        updateUserStats();
      } else if (postCard) {
        const postId = parseInt(postCard.dataset.id);
        openPostModal(postId);
      }
    });

    function openPostModal(postId) {
      const post = posts.find(p => p.id === postId);
      if (!post) return;

      viewPostModal.dataset.currentPostId = postId;
      document.getElementById('view-post-title').textContent = post.title;

      const coverImg = document.getElementById('view-post-cover');
      if (post.image) {
        coverImg.src = post.image;
        coverImg.style.display = 'block';
      } else {
        coverImg.style.display = 'none';
      }

      document.getElementById('view-post-header').innerHTML = `
                <img src="${post.avatar}" alt="Author Avatar" class="user-avatar">
                <div>
                    <div class="author-name">${post.author} ${post.isEdited ? '<span class="edited-tag">(edited)</span>' : ''}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">${formatDate(post.timestamp)}</div>
                    ${post.tags.length > 0 ? `
                        <div class="post-tags" style="margin-top: 0.5rem;">
                            ${post.tags.map(tag => `<span class="post-tag">#${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `;

      document.getElementById('view-post-content').innerHTML = post.content.replace(/\n/g, '<br>');

      const commentForm = document.getElementById('comment-form');
      commentForm.dataset.postId = postId;
      renderComments(post.comments);

      const isCurrentUserPost = post.author === 'Current User';
      editPostBtn.style.display = isCurrentUserPost ? 'inline-flex' : 'none';
      deletePostBtn.style.display = isCurrentUserPost ? 'inline-flex' : 'none';

      openModal(viewPostModal);
    }

    // Edit post
    editPostBtn.addEventListener('click', () => {
      const postId = parseInt(viewPostModal.dataset.currentPostId);
      const post = posts.find(p => p.id === postId);
      if (!post) return;

      closeModal(viewPostModal);
      modalFormTitle.textContent = "Edit Your Post";
      postIdInput.value = post.id;
      postTitleInput.value = post.title;
      postContentInput.value = post.content;
      postTagsInput.value = post.tags.join(', ');

      if (post.image) {
        imagePreview.src = post.image;
        imagePreview.style.display = 'block';
        newPostImageData = post.image;
      } else {
        imagePreview.style.display = 'none';
        newPostImageData = null;
      }

      openModal(createPostModal);
    });

    // Delete post
    deletePostBtn.addEventListener('click', () => {
      if (!confirm('Are you sure you want to delete this post? This action cannot be undone.')) return;

      const postId = parseInt(viewPostModal.dataset.currentPostId);
      posts = posts.filter(p => p.id !== postId);

      renderPosts();
      updateTrendingTopics();
      updateUserStats();
      closeModal(viewPostModal);
    });

    function renderComments(comments) {
      const commentsList = document.getElementById('comments-list');
      commentsList.innerHTML = '';

      if (comments.length === 0) {
        commentsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No comments yet. Be the first to comment!</p>';
        return;
      }

      comments.forEach((comment, index) => {
        const commentEl = document.createElement('div');
        commentEl.className = 'comment';
        commentEl.style.animationDelay = `${index * 0.1}s`;
        commentEl.innerHTML = `
                    <div class="comment-header">
                        <img src="https://placehold.co/32x32/22c55e/FFF?text=${comment.author.charAt(0)}" alt="Commenter Avatar" class="user-avatar" style="width: 28px; height: 28px;">
                        <div class="comment-author">${comment.author}</div>
                    </div>
                    <p>${comment.text}</p>
                `;
        commentsList.appendChild(commentEl);
      });
    }

    // Comment submission
    document.getElementById('comment-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const postId = parseInt(e.currentTarget.dataset.postId);
      const post = posts.find(p => p.id === postId);
      const commentInput = e.currentTarget.querySelector('input');

      const newComment = {
        author: 'Current User',
        text: commentInput.value.trim()
      };

      post.comments.push(newComment);
      renderComments(post.comments);
      renderPosts();
      commentInput.value = '';
    });

    // Filter buttons
    myPostsBtn.addEventListener('click', () => {
      filterPosts('author', 'Current User');
    });

    allPostsBtn.addEventListener('click', () => {
      clearActiveFilter();
    });

    // Mobile menu toggle
    menuToggle.addEventListener('click', () => {
      leftSidebar.classList.toggle('open');
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (window.innerWidth <= 900 &&
              leftSidebar.classList.contains('open') &&
              !leftSidebar.contains(e.target) &&
              !menuToggle.contains(e.target)) {
        leftSidebar.classList.remove('open');
      }
    });

    // Theme toggle
    const themeToggleBtn = document.getElementById('theme-toggle');
    themeToggleBtn.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);

      // Update icon
      const icon = themeToggleBtn.querySelector('i');
      icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      // Escape key closes modals
      if (e.key === 'Escape') {
        if (createPostModal.classList.contains('open')) closeModal(createPostModal);
        if (viewPostModal.classList.contains('open')) closeModal(viewPostModal);
      }

      // Ctrl/Cmd + K for search focus
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        mainSearchInput.focus();
      }

      // Ctrl/Cmd + N for new post
      if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
        e.preventDefault();
        createPostBtn.click();
      }
    });

    // Initialize
    renderPosts();
    updateTrendingTopics();
    updateUserStats();
    //createInsects();

    // Performance optimization: Debounce search
    let searchTimeout;
    mainSearchInput.addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const searchTerm = e.target.value.trim();
        if (searchTerm) {
          filterPosts('search', searchTerm);
        } else {
          clearActiveFilter();
        }
      }, 300);
    });
  });
</script>
</body>
</html>